<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ L.get('register_title','新規登録') }}</title>
  <link rel="stylesheet" href="/static/auth.css" />
  <script defer src="/static/auth.js"></script>
</head>
<body class="page-register">
  <!-- 右上語言列（含高亮） -->
  <nav class="topbar">
    {% set cur = request.cookies.get('lang','ja') %}
    <a class="{{ 'active' if cur=='ja' else '' }}" href="/lang?set=ja&next={{ request.url.path }}">日本語</a>
    <a class="{{ 'active' if cur=='en' else '' }}" href="/lang?set=en&next={{ request.url.path }}">English</a>
    <a class="{{ 'active' if cur in ['zh','zh-Hant'] else '' }}" href="/lang?set=zh-Hant&next={{ request.url.path }}">繁體中文</a>
    <a class="{{ 'active' if cur=='zh-Hans' else '' }}" href="/lang?set=zh-Hans&next={{ request.url.path }}">简体中文</a>
  </nav>

  <div class="auth-wrap">
    <div class="card">
      <aside class="aside">
        <div>
          <h1>{{ L.get('brand','旅行管理') }}</h1>
          <p>{{ L.get('register_subtitle','旅の計画、荷物、日程を一括管理。') }}</p>
        </div>
      </aside>

      <main class="main">
        {% if msg %}<div class="msg">{{ msg }}</div>{% endif %}

        <!-- 1) メール認証コード送信（有 JS 時 AJAX；否則走表單提交） -->
        <h2 class="section-title">{{ L.get('email_verification','メール認証') }}</h2>
        <form id="sendCodeForm" method="post" action="/register/send-code"
              data-err-mismatch="{{ L.get('error_email_mismatch','メールアドレスが一致しません') }}"
              data-sending="{{ L.get('sending','送信中…') }}">
          <div class="row">
            <input type="email" id="email" name="email"
                   placeholder="{{ L.get('email','メールアドレス') }}"
                   autocomplete="email" required />
            <input type="email" id="email_confirm" name="email_confirm"
                   placeholder="{{ L.get('email_confirm','メール（確認）') }}"
                   autocomplete="email" required />
          </div>
          <div class="actions">
            <button type="submit" id="sendCodeBtn" class="btn">{{ L.get('send_code','認証コードを送信') }}</button>
            <span id="sendCodeHint" class="muted"></span>
          </div>
          <div id="codeStatus" class="muted"></div>
        </form>

        <div class="split"></div>

        <!-- 2) 本登録（6位數驗證碼 + 基本資料） -->
        <form method="post" action="/register" class="stack" novalidate>
          <div class="row">
            <input 
              name="login_id" id="login_id"
              placeholder="{{ L.get('login_id','Login ID') }}（{{ L.get('hint_login_id','英数字 5～20 文字') }}）"
              minlength="5" maxlength="20" pattern="[A-Za-z0-9]{5,20}"
              autocomplete="username" required
            />
          </div>

          <div class="row">
            <input 
                   type="password" id="pw1" name="password"
                   placeholder="{{ L.get('password','パスワード') }}（{{ L.get('hint_password','8～20 文字') }}）"
                   minlength="8" maxlength="20"
                   autocomplete="new-password" required />
            <!-- eye / eye-off 切換（配合 /static/auth.js） -->
            <button class="eye-btn" type="button"
                    data-target="pw1"
                    aria-label="{{ L.get('show_pw','パスワードを表示') }}"
                    data-label-show="{{ L.get('show_pw','パスワードを表示') }}"
                    data-label-hide="{{ L.get('hide_pw','パスワードを非表示') }}">
              <!-- eye -->
              <svg class="icon-eye" viewBox="0 0 24 24" width="20" height="20" fill="none"
                   stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <!-- eye-off -->
              <svg class="icon-eye-off" viewBox="0 0 24 24" width="20" height="20" fill="none"
                   stroke="currentColor" stroke-width="2" aria-hidden="true" style="display:none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12Z"/>
                <circle cx="12" cy="12" r="3"/>
                <path d="M3 3L21 21"/>
              </svg>
            </button>
          </div>

          <div class="row">
            <input type="password" id="pw2" name="password_confirm"
                   placeholder="{{ L.get('password_confirm','パスワード（確認）') }}"
                   minlength="8" maxlength="20"
                   autocomplete="new-password" required />
            <button class="eye-btn" type="button"
                    data-target="pw2"
                    aria-label="{{ L.get('show_pw','パスワードを表示') }}"
                    data-label-show="{{ L.get('show_pw','パスワードを表示') }}"
                    data-label-hide="{{ L.get('hide_pw','パスワードを非表示') }}">
              <svg class="icon-eye" viewBox="0 0 24 24" width="20" height="20" fill="none"
                   stroke="currentColor" stroke-width="2" aria-hidden="true">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12Z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="icon-eye-off" viewBox="0 0 24 24" width="20" height="20" fill="none"
                   stroke="currentColor" stroke-width="2" aria-hidden="true" style="display:none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12Z"/>
                <circle cx="12" cy="12" r="3"/>
                <path d="M3 3L21 21"/>
              </svg>
            </button>
          </div>

          <div class="row">
            <input type="email" name="email" id="email2"
                   placeholder="{{ L.get('email','メールアドレス') }}"
                   autocomplete="email" required />
            <input type="email" name="email_confirm" id="email2_confirm"
                   placeholder="{{ L.get('email_confirm','メール（確認）') }}"
                   autocomplete="email" required />
          </div>

          <div class="row">
            <input name="code"
                   placeholder="{{ L.get('code','認証コード（メールに記載）') }}"
                   minlength="6" maxlength="6"
                   inputmode="numeric" pattern="\\d{6}"
                   data-msg-pattern="{{ L.get('code_hint','6 桁の数字を入力してください') }}"
                   required />
          </div>

          <div class="actions">
            <button type="submit" class="btn">{{ L.get('register','登録する') }}</button>
            <a href="/login" class="auth-link">{{ L.get('to_login','ログインへ戻る') }}</a>
          </div>
          <p class="muted">{{ L.get('register_hint','メールで届いた6桁コードを入力して登録を完了してください。') }}</p>
        </form>
      </main>
    </div>
  </div>
</body>
</html>
